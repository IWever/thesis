\chapter{Simulation environment}
\label{app:tool}
In the next parts, situations will be simulated. For part \ref{part:MT} this is done to evaluate criteria for the decision model and problem identification. While part \ref{part:CS} aims to get expert feedback on the protocol.

The different scenarios will be simulated using a tool. This tool will be able to simulate the scenarios to give more insight why decisions are made. Full scale testing will cost much more money, time and effort, as it is harder to control. Small scale testing will introduce many unknown factors. Therefore is chosen to build an application in which models can be simulated and tested.
A start is made with a basic tool, which will continuously be improved. Changes in requirements might appear trough out the whole process, to deliver a better tool. The code is written in such a way that it is easy to maintain and improve by using different modules.

\section{Foundation}
The first step is to set the goals or requirements of the tool. This doesn't mean it is a full description of the tool, but features it should at least have to be able to answer the research questions.
The most important requirement is that ships within the simulation behave similarly to ships in reality. This does not necessarily mean that all hydromechanics should be known. But ships should have similar behaviors when turning or changing speed. This can be based on sea-trials and done using a mapping from current speed, current rotation, rudder angle and throttle to future speed and turning speed.
The second requirement should be that it is flexible, in a way that different scenarios can be added, tested and visualized easily. Thereby changing ship characteristics, shared information and other inputs.
Thirdly, it must be possible to show the register of possible decisions for the different vessels. To be able to validate this with seafarers. Meaning it will be a white box model.

\subsection{User stories}
The next step is to define users stories from the requirements. User stories are in a form: \emph{"As a [user] I want [action] so that [result]"}. Extending them with an acceptance criteria this will result in the features which should be implemented.

Within the tool there will be different roles. For which these user stories can be used. These can be split between users and objects. Below these are described:
\begin{itemize}
	\item \emph{Operator}. The person who set-up the simulation and fills in the different properties for the ships and specific scenario.
	\item \emph{Viewer}. Someone who uses the application to view a specific scenario. Thereby trying to answer the research questions.
	\item \emph{Ship}. Object in the map which is used by the simulation. But to work correctly it also had needs for information.
\end{itemize}

Some examples of those user stories are given below. All users stories can be found in appendix XXX.\todo{add user stories to appendix}. 
\begin{itemize}
	\item As an operator, I want to add vessels to the map, by selecting them in a list, so that they become part of the simulation. \\
	Acceptance criteria: Ship visualized and other ships start receiving information.
	\item As a viewer, I want to to be able to get the belief state, intention and next action of a ship, so that I can verify if it is what I expected it to be. \\
	Acceptance criteria: Belief state, intention and next action are shown.
	\item As a ship, I want to be able to predict the path of other vessels, so that I can make my decisions based on this. \\
	Acceptance criteria: correctly updated belief state about other vessels.
\end{itemize}

\subsection{Requirements}
The acceptance criteria for the application is: The ability to insert a model for decision making for a ship, which depends on information collected from other ships closeby, its own ship characteristics and the environment it acts in.

There must also be considered that several assumptions are made to create a system which works in a practical manner, as not al input data is available or calculations might be very hard and slow down the simulation too much. The assumptions made are: ...
\todo{Extend with more specific requirements}

\section{Architecture}
\todo{describe different modules}

\section{Design specifications}

\subsection{Ship description}

\subsection{Environment description}

\subsection{Hydrodynamic model}
\label{apps:hydro-model}
This can be based on sea-trials and done using a mapping from current speed, current rotation, rudder angle and throttle to future speed and turning speed.

Turning rate rudder: 2,3 deg/s in regulations, 2,5 based on \cite{Artyszuk2016}, 3 deg/s based on \cite{Molland2007}.
$a_H = 2.5$ empirical amplification factor of (effective) rudder force due to hull‚Äêrudder interaction [0.6]


\subsection{Radio}
The area in which situations are tested are not larger than the radius of an VHF radio (about 20 NM - IMO regulations)

\url{http://solasv.mcga.gov.uk/m_notice/mgn/mgn324.pdf} - p8

\subsection{Controller}
Based on the waypoints there is a simple controller to adjust the rudder angle. This controller steers based on the relative angle between the waypoint and the current position. This is done in the \emph{adjustRudder} function. The distance and relative angle is calculated, this is used in a simple decision tree to decide on the rudder angle, which is similar to a so-called "proportional controller". For this simulation it will give enough accuracy. For a better result, a "PID-controller" could be implemented:

\begin{table}[H]
	\centering
	\begin{tabular}{l|l}
		\toprule
		Relative angle (\degree) & Rudder angle (\degree) \\
		\midrule
		25-180 & 35\\
		10-25 & 25\\
		0-10 & Relative angle $*$ 8/10 \\
		\bottomrule
	\end{tabular}
	
	\captionof{table}{Rudder angle based on relative angle}
	\label{tab:Rudder-angle}
\end{table}

\section{Build}
printscreens\\
User interface\\
Graphs\\
Quality/Dependency analysis (dt vs runtime)\\
Currently implemented (level of intelligence)
Currently is a hydro model implemented, you are able to steer the ship or use waypoints and a background image can be used to show the map.

\begin{figure}[hb]
	\centering
	\makebox[\textwidth][c]{
		\includegraphics[width=1.18\textwidth]{printscreen20180805.png}
	}
	\caption{Example of evaluation tool}
	\label{fig:printscreen-tool}
\end{figure}