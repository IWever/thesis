\chapter{Definition of criteria for evaluation of situation}
\label{ch:criteria-problem}
To determine whether a problem might occur in the situations and scenarios as identified in the previous chapter, different criteria are evaluated. The current systems calculate most of these criteria, such as \ac{ECDIS} and \ac{ARPA}. However, they do use linearised algorithms. These do not predict the \ac{CPA} and crossing distance correctly while turning, often resulting in many dismissed alarms. This chapter describes different criteria, followed by the calculation needed to evaluate these criteria. This description and calculation are given for both the linearised algorithms and proposed algorithms. Later in the process, these criteria can be used again, to ensure that the chosen strategies ensure safe operation with low perceived risk.

\section{Calculations based on current systems}
\label{sec:linearised-methods}
Within \ac{ARPA} and \ac{ECDIS}, different calculations are made, which can be used to evaluate if there is a problem in the current scenario. These calculations often use linearised algorithms, which results are not correct when turning. Humans can easily dismiss the false alarms given due to these wrong results. Computers do not handle these false positives well. The advantage, however, is that the calculations can be done very fast. Below these calculations are discussed for the \acf{CPA} and crossing position.

\subsection{Closest point of approach}
The \ac{CPA} refers to the positions at which two dynamically moving objects reach their closest possible distance, which is an important calculation for collision avoidance. A linearised form uses two points moving at fixed speed and fixed direction. Figure \ref{fig:CPA} shows an example, where P and Q are the moving points, with corresponding direction vectors $u$ and $v$, which include the speed and direction.

\begin{figure}[h]
	\centering
	\includegraphics[scale=0.6]{CPA_lines.png}
	\caption{Example for \acf{CPA}}
	\label{fig:CPA}
\end{figure}

A formula can be derived for the closest point of approach. With the motion equations for $P$ and $Q$, the distance can be calculated. Where $P_0$ and $Q_0$ are the current positions, and $u$ and $v$ are the corresponding speed vectors:
\begin{equation}
\label{eq:motion}
P(t) = P_0 + t \cdot u ;\quad  Q(t) = Q_0 + t \cdot v
\end{equation}
\begin{equation}
d(t) = |P(t) - Q(t)| = |P_0 - Q_0 + t (u - v)|
\end{equation}

Since d(t) is a minimum when $D(t) = d(t)^2$ is a minimum, this is the case when the derivative is equal to 0:
\begin{equation}
D(t) = d(t)^2 = (u - v) \bullet (u - v) t^2 + 2 (P_0 - Q_0) \bullet (u - v) t + (P_0 - Q_0) \bullet (P_0 - Q_0)
\end{equation}
\begin{equation}
\frac{d D(t)}{dt} = 0 = 2t[(u - v) \bullet (u-v)] + 2 (P_0 - Q_0) \bullet (u - v)
\end{equation}

This equation can be solved for t, to calculate the moment where CPA is the smallest:
\begin{equation}
\label{eq:t_CPA}
t_{CPA} = \frac{-(P_0 - Q_0) \bullet (u - v)}{|u - v|^2}
\end{equation}
\begin{equation}
d_{CPA}(t_{CPA}) = |P_0 - Q_0 + \frac{-(P_0 - Q_0) \bullet (u - v)}{|u - v|^2} \bullet (u - v)|
\end{equation}
If $t_{CPA}$ is smaller than 0, the CPA is in the past. If $t_{CPA}$ is equal to 0, the CPA is right now, else it is in the future. If $u$ and $v$ are the same, the denominator of equation~\ref{eq:t_CPA} is equal to 0. This means that the CPA is constant.

\subsection{Crossing distance}
The crossing distance is the distance between two ships if they pass each others path. The position of another vessel can be both in front or behind a vessel. This distance is mostly relevant for how safe a crossing situation feels. The crew on manned ships do not want to have ships too close in front of them, as they can't do an evasive manoeuvrer in those situations. The same motion equation as for CPA can be used (equation \ref{eq:motion}). 

\begin{figure}[h]
	\centering
	\includegraphics[scale=0.6]{crossing_lines.png}
	\caption{Example for crossing point and distance}
	\label{fig:crossing-distance}
\end{figure}

In figure \ref{fig:crossing-distance} the distance is calculated between two points at a certain moment in time. The first step is to calculate the crossing point (cp) of the two lines:
\begin{equation}
P(t_{cp,p}) = Q(t_{cp,q}) \rightarrow P_0 + t_{cp,p} \cdot u = Q_0 + t_{cp,q} \cdot v
\end{equation}
\begin{equation}
t_{cp,P} = \frac{(Q_0 - P_0) \times v}{u \times v}
\end{equation}
\begin{equation}
t_{cp,Q} = \frac{(P_0 - Q_0) \times u}{v \times u}
\end{equation}
\begin{equation}
cp = P_0 + \left[ \frac{(Q_0 - P_0) \times v}{u \times v} \right] \cdot u =  Q_0 + \left[ \frac{(P_0 - Q_0) \times u}{v \times u} \right] \cdot v
\end{equation}

The next step is to determine where each vessel is when the other vessel is at the crossing point. To determine finally what the crossing distance is:
\begin{equation}
P(t_{cp,Q}) = P_0 + \left[ \frac{(Q_0 - P_0) \times v}{u \times v} \right] \cdot u
\end{equation}
\begin{equation}
Q(t_{cp,P}) = Q_0 + \left[ \frac{(P_0 - Q_0) \times u}{v \times u} \right] \cdot v
\end{equation}
\begin{equation}
d(t) = |P(t) - Q(t)|
\end{equation}
The crossing distance (cd) for when P crosses Q and vice versa, can be calculated using the following formulas:
\begin{equation}
d_{cd,PQ}(t_{cp,P}) = |P(t_{cp,P}) - Q(t_{cp,P})|
\end{equation}
\begin{equation}
d_{cd,QP}(t_{cp,Q}) = |P(t_{cp,Q}) - Q(t_{cp,Q})|
\end{equation}

\section{Proposed algorithm based on planned path}
Better non-linearised methods are necessary for the calculation of the \ac{CPA} and crossing point, to improve the evaluation of criteria. By predicting the likely path of a vessel, improved estimations can be made. These use a first-order change, based on the rate of turn and course. This prediction can be extended with a combination of expected location and the probability that another ship is choosing a specific strategy.

Although it will result in better evaluations, the disadvantage is that much heavier computations are required, while also introducing uncertainty with the numerical solver. 
The first step will be to make a combination of both the linearised and non-linearised methods. The calculations have to be done for every combination of ships.

The Bézier curve is used to describe the paths in a non-linearised manner. This section first defines a Bézier curve. Followed by the same criteria as in the previous section: \acf{CPA} and crossing distance. This time describing the algorithm using to calculate it in a non-linearised manner.

\subsection{Bézier curve}
The first iteration of the algorithm is semi-linearised, where the path of own ship is represented by a Bézier curve, based on its waypoints and strategy. Points have to be fitted along the planned path to describe the Bézier curve. This method is similar to the method as described by Taams \cite{Taams2018}. The path prediction for the other ship is still linearised, new systems and protocols have to be introduced to gather enough information on the strategy and waypoints.

For the calculation does the distance function not change. This is still $
d(t) = |P(t) - Q(t)|$. However is P taken as own ship and gets a new formula using the Bézier curve. This curve has a degree of $n$, which depends on the way-points and can be described using the following equations:
\begin{equation}
P(t) = \sum\limits_{i=0}^n b_{i,n}(t) \cdot P_i \quad and
\end{equation}
\begin{equation}
b_{i,n}(t) = \left( \begin{array}{c} n \\ i \end{array}\right) t^i(1-t)^{n-i}, i = 0,\dots,n
\end{equation}

\subsection{Closest point of approach}
\label{ssec:CPA-calculation}
The numerical algorithm used to calculate the CPA is shown below. Herein is the path of own vessel represented by a Bézier curve. While other vessels are represented with a linearised function as described in section~\ref{sec:linearised-methods}. This results in the following algorithm:
\begin{enumerate}
	\item Check if situation (course, speed, other vessels) has changed since last calculation:
	\begin{enumerate}
		\item No, break
		\item Yes, continue
	\end{enumerate}
	\item Use waypoints to determine expected path for own ship (Bézier curve).
	\item Use path to determine the location for each time-step.
	\item Use course and speed other ships to determine their location for each time-step
	\item Calculate distance between ships for each time-step:
	\begin{enumerate}
		\item If smaller than stored CPA, update stored CPA with calculated CPA
		\item If larger than stored CPA, do not update stored CPA
	\end{enumerate}
	\item Return CPA
\end{enumerate}

\subsection{Crossing distance}
The algorithm to calculate the crossing distance will require much less computational power, as not all time-steps have to be calculated. Just the ones where the paths cross. The following algorithm can be used. It should be noted that some calculations from the CPA calculation can be reused.
\begin{enumerate}
	\item Check if something has changed since last calculation:
	\begin{enumerate}
		\item No, break
		\item Yes, continue
	\end{enumerate}
	\item Use waypoints to determine expected path for own ship (Bézier curve).
	\item Determine crossing point(s) between linear path and Bézier curve.
	\item Check if crossing points exist:
	\begin{enumerate}
		\item No, break
		\item Yes, determine location for crossing point(s)
	\end{enumerate}
	\item Calculate time when ships are at crossing point(s).
	\item Calculate distance between ships at time of crossing.
	\item Return crossing distances.
\end{enumerate}

\vspace{1.5cm}
\emph{The next chapter} describes the criteria that depend on the manoeuvrability characteristics of a ship. Using the \ac{CPA} and crossing distance can be determined whether the chosen strategy without communication will result in safe operation. Where the algorithms as discussed in this chapter, will give more exact results.

